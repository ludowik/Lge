<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <meta name="viewport"
        content="viewport-fit=cover, user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <title>LGE</title>

    <link rel="stylesheet" href="style.css" />

    <script src="js/lib/fengari-web.js"></script>
    <script src="js/lib/p5.min.js"></script>
</head>

<body>

    <script type="application/lua" src="js.lua" async></script>
    <script async>
        console.clear();

        var needSetup = true;

        function setup() {
            createCanvas(
                window.innerWidth,
                window.innerHeight);
        }

        function draw() {
            print('call draw');
            if (needSetup) {
                var setup = fengari.load('return __setup')();
                var draw = fengari.load('return __draw')();
                if (setup || draw) {
                    if (setup) setup();
                    if (draw) draw();
                    needSetup = false;
                }
            } else {
                fengari.load('return __draw()')();
            }
        }

        function mousePressed() {
            fengari.load('return mousepressed()')();
        }

        function mouseReleased() {
            fengari.load('return mousereleased()')();
        }
    </script>

</body>

</html>